<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VMM Tracker Data Sender</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #1a1a1a;
      color: #fff;
      overflow: hidden;
    }

    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #video-container {
      position: relative;
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      overflow: hidden;
      min-height: 0;
    }

    #video {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      transform: scaleX(-1);
    }

    #preview-canvas {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      display: none;
    }

    #preview-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      display: none;
    }

    #controls {
      padding: 1rem;
      background: #2a2a2a;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      flex-shrink: 0;
    }

    .control-row {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    input, button, select {
      padding: 0.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
    }

    input {
      flex: 1;
      background: #3a3a3a;
      color: #fff;
    }

    button {
      background: #007bff;
      color: #fff;
      cursor: pointer;
      font-weight: 600;
    }

    button:hover {
      background: #0056b3;
    }

    button:disabled {
      background: #555;
      cursor: not-allowed;
    }

    select {
      background: #3a3a3a;
      color: #fff;
    }

    .status {
      font-size: 0.875rem;
      color: #aaa;
    }

    .status.connected {
      color: #28a745;
    }

    .status.error {
      color: #dc3545;
    }

    .footer {
      padding: 0.5rem 1rem;
      background: #1a1a1a;
      text-align: center;
      font-size: 0.75rem;
      color: #888;
    }

    .footer a {
      color: #888;
      text-decoration: underline;
      cursor: pointer;
    }

    .footer a:hover {
      color: #aaa;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.open {
      display: flex;
    }

    .modal-content {
      background: #2a2a2a;
      padding: 2rem;
      border-radius: 8px;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 2rem;
      height: 2rem;
      line-height: 2rem;
    }

    .modal-close:hover {
      color: #ccc;
    }

    .modal h2 {
      margin-top: 0;
      margin-bottom: 1rem;
    }

    .license-section {
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: #1a1a1a;
      border-radius: 4px;
    }

    .license-section h3 {
      margin-top: 0;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .license-section p {
      margin: 0.5rem 0;
      font-size: 0.875rem;
      line-height: 1.5;
    }

    .license-section a {
      color: #007bff;
      text-decoration: none;
    }

    .license-section a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="video-container">
      <video id="video" autoplay playsinline></video>
      <canvas id="preview-canvas"></canvas>
      <div id="preview-overlay"></div>
    </div>
    <div id="controls">
      <div class="control-row">
        <label style="color: #aaa;">Format:</label>
        <select id="webrtc-format-select">
          <option value="compressed">Compressed (Binary)</option>
          <option value="readable">Readable (JSON)</option>
        </select>
        <label style="color: #aaa;">Preview:</label>
        <select id="preview-mode-select">
          <option value="status-data">表示なし</option>
          <option value="status-data-landmarks" selected>ランドマーク</option>
          <option value="video-raw">映像</option>
        </select>
      </div>
      <div class="control-row">
        <button id="start-camera-btn">Start Camera</button>
        <button id="stop-tracking-btn" disabled>Stop Tracking</button>
        <span class="status" id="connection-status"></span>
        <span class="status" id="status">Ready</span>
      </div>
    </div>
    <div class="footer">
      <a href="https://github.com/malaybaku/VmmTrackerDataSender" target="_blank" rel="noopener noreferrer">Source (GitHub)</a>
      <span style="margin: 0 0.5rem;">|</span>
      <a id="licenses-link">Licenses</a>
      <span style="margin: 0 0.5rem;">|</span>
      <a href="privacy-policy.html" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
    </div>
  </div>

  <!-- Connection Modal -->
  <div id="connection-modal" class="modal">
    <div class="modal-content" style="text-align: center;">
      <p id="connection-modal-message" style="white-space: pre-line; line-height: 1.6;"></p>
      <button id="connection-modal-close" style="margin-top: 1rem; display: none;">OK</button>
    </div>
  </div>

  <!-- License Modal -->
  <div id="license-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="modal-close">&times;</button>
      <h2>Third-Party Licenses</h2>

      <div class="license-section">
        <h3>MediaPipe</h3>
        <p><strong>Version:</strong> @mediapipe/tasks-vision ^0.10.14</p>
        <p><strong>Copyright:</strong> 2019-2024 The MediaPipe Authors</p>
        <p><strong>License:</strong> Apache License 2.0</p>
        <p>
          Licensed under the Apache License, Version 2.0 (the "License");
          you may not use this file except in compliance with the License.
          You may obtain a copy of the License at
        </p>
        <p><a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">http://www.apache.org/licenses/LICENSE-2.0</a></p>
        <p>
          Unless required by applicable law or agreed to in writing, software
          distributed under the License is distributed on an "AS IS" BASIS,
          WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
          See the License for the specific language governing permissions and
          limitations under the License.
        </p>
        <p><strong>Repository:</strong> <a href="https://github.com/google-ai-edge/mediapipe" target="_blank" rel="noopener noreferrer">https://github.com/google-ai-edge/mediapipe</a></p>
      </div>

      <div class="license-section">
        <h3>qrcode</h3>
        <p><strong>Version:</strong> ^1.5.4</p>
        <p><strong>Author:</strong> Ryan Day (soldair)</p>
        <p><strong>License:</strong> MIT License</p>
        <p><strong>Repository:</strong> <a href="https://github.com/soldair/node-qrcode" target="_blank" rel="noopener noreferrer">https://github.com/soldair/node-qrcode</a></p>
      </div>

      <div class="license-section">
        <h3>qr-scanner</h3>
        <p><strong>Version:</strong> ^1.4.2</p>
        <p><strong>Author:</strong> Nimiq</p>
        <p><strong>License:</strong> MIT License</p>
        <p><strong>Repository:</strong> <a href="https://github.com/nimiq/qr-scanner" target="_blank" rel="noopener noreferrer">https://github.com/nimiq/qr-scanner</a></p>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
  <script>
    // License modal functionality
    const licensesLink = document.getElementById('licenses-link');
    const licenseModal = document.getElementById('license-modal');
    const modalClose = document.getElementById('modal-close');

    licensesLink.addEventListener('click', (e) => {
      e.preventDefault();
      licenseModal.classList.add('open');
    });

    modalClose.addEventListener('click', () => {
      licenseModal.classList.remove('open');
    });

    licenseModal.addEventListener('click', (e) => {
      if (e.target === licenseModal) {
        licenseModal.classList.remove('open');
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && licenseModal.classList.contains('open')) {
        licenseModal.classList.remove('open');
      }
    });
  </script>
</body>
</html>
