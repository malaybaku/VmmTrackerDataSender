# VmmTrackerDataSender

## About

このテキストはプロンプトに書くには長すぎる要件をあらかじめ記述したファイルです。

Coding Agentはこのファイルを編集してはいけません。その代わり、必要に応じてAgent自身が読み込む別ファイルに要点をサマリーして下さい。

## 目的

本プロジェクトの目的は大まかには以下の通りです。

- モバイル端末上で、アプリのインストール作業を行わずに手軽に顔トラッキング等のトラッキングが実行できる
- それを、所定のプロトコルをサポートするPC側のアプリに送信できる
- その結果、PC上の処理負荷を抑えつつPC上で実行されるアプリケーション(VRMの表示アプリ等)で顔トラッキング結果が活用できる

なお、本プロジェクトでは一貫してエンドユーザが1人のケースを想定してよく、複数人を同時にトラッキングするユースケースは考慮不要です。

## 要件

このレポジトリはGitHub上でpublicになる前提のレポジトリで、下記の2プロジェクトを含む必要があります。1,2それぞれの要件はさらに後述のセクションで詳解し、送受信するデータのフォーマットも後述のセクションで詳解します。

1. 静的なwebページであって、MediaPipeを利用した顔トラッキングを行い、トラッキング結果(頭部姿勢、ブレンドシェイプ)を、WebRTCのDataChannelを用いてローカルエリアネットワーク内のPCに送信するようなもの。特に、モバイルで動作することを想定したもの。
2. .NETのコンソールプログラムであって、上記のwebページからPC宛に送信されるデータを受信/デシリアライズしてコンソール出力できるようなもの。つまり受信アプリケーションのリファレンス実装となるもの。


## 1. 顔トラッキングを行う静的webページ

このwebページはGitHub Pagesでホストされる想定のページであり、原則として単一のページだけから構成されます。

webページにアクセスするとMediaPipeによる顔トラッキング(blendShapeオプションつき)を

そのほか、このプログラムは下記に留意して作成して下さい。


## 2. 顔トラッキングのデータを受信する.NETコンソールアプリ

このプログラムで、は必要に応じてLANからアクセスされる前提のサーバーを立てるなどして、1のwebページからのデータを受信します。

あくまで受信処理のリファレンス実装であるため、受信したデータをコンソール出力する以上の詳細な挙動は実装不要です。

そのほか、このプログラムは下記に留意して作成して下さい。

- 受信アプリケーションはWindows上の WPF または Unity 6.0 製アプリケーションとして作成される場合があるため、これらの技術スタックとの相性に留意して下さい。
    - 例えば、新しすぎる.NETの機能を前提とすることは望ましくありません。
- 上記の注意は踏まえたうえで、リファレンス実装そのものはOS依存性が低いことが望ましいです。
- 1を実行するモバイル端末と2を実行するWindows端末が同一LAN内に存在することは前提としてよいです。
- 必要な場合、2から1宛にroom idのようなデータ送信上必要な識別情報を提示することを前提としても構いません。
- 2は送られるデータが後述のCompressed, Readableいずれであるかを事前に知っていてよいものとします。動的にこれらの2フォーマットを判別する必要はありません。 


## 送受信するデータ

データは次の2種類のフォーマットを選択して送信できるようにして下さい。ただしフォーマットは将来さらに変更する可能性があるので、データ構造とシリアライズの間に適切な抽象化を行って下さい。

データ: 

a. 端末のカメラから見た座標系で示される、ユーザーの顔(Head)ボーンの姿勢情報
    - つまりx,y,zの位置と頭部回転を示すQuaternionまたはオイラー角表現の角度で、6個または7個の数値になります。
    - これらは単精度浮動小数点、または半精度浮動小数点数で送信します。
b. MediaPipeから取得できるBlendshape情報(52個)。
    - これらはMediaPipeからは0以上1以下の小数値として取得できるはずですが、それを0~255の1byte整数にした値として送信します。

### Compressed

Compressedフォーマットでは、データaとデータbを、所定の固定された順序でバイナリとして並べただけのデータを構成します。

### Readable

Readableフォーマットでは、データをminifyされたjsonとして構成します。

- データa, bそれぞれに`headPose`, `blendShape`というキーが割り当てられます。
- データaには更に`px,py,pz,rx,ry,rz,rw`のようなキーが割あたり、`blendShape`には`eyeLeftBlink`など、MediaPipeが付与しているブレンドシェイプ名がキーとして使用されます。


## このRequirementの記述時点で決定していない/Agentが検討すべき事項

- DataChannelを今回のような目的で使うことの妥当性 (※一度検討したうえでDataChannelを使う判断をしていますが、その妥当性は最初に改めて検証されるべきです)
- webページのフレームワークで何を使うか
- .NETバージョンなど、各種のフレームワーク/ライブラリのバージョン
- webページと.NETプロジェクトの具体的なフォルダ分割
    - 基本的にレポジトリのルートフォルダ上で分けられているべきだとは思っています。
- GitHub Pagesへの公開方法
    - GitHub Actionsによる方法が望ましいつもりですが、他になにかあれば随時提案して下さい
- ハンドトラッキングも実施するかどうか
    - これは「将来拡張する可能性があるが今やらないこと」として留意して下さい。
